from agents.base_agent import BaseAgent

class NetPentester(BaseAgent):
    """Specialist for network-layer reconnaissance and exploitation."""
    
    def __init__(self):
        super().__init__("Network Pentester", "Logic for Nmap, Metasploit, and network services.")

    def execute(self, task):
        # 1. ANALYZE TASK
        prompt = f"""
        Task: {task}
        
        Available Tools: nmap, masscan, netcat, metasploit (msfconsole -x), enum4linux, smbclient, snmpwalk.
        Network Services: SSH, FTP, SMB, SNMP, HTTP, DNS, RDP, Telnet.
        
        Determine the best command to run for network reconnaissance or exploitation.
        Output ONLY the command or [COMPLETE] if the objective is met.
        
        Examples:
        - Port scan: nmap -sV -sC -p- <target>
        - SMB enumeration: enum4linux -a <target>
        - Service banner grab: nc -nv <target> <port>
        """
        decision = self.reason(prompt)
        
        if "[COMPLETE]" in decision.upper():
            return {"status": "complete", "summary": decision}

        # 2. RUN COMMAND
        cmd = decision.strip().replace("`", "").split("\n")[0]  # Clean LLM artifacts
        result = self.run_cmd(cmd)
        
        # 3. SUMMARIZE
        summary = self.summarize_result(cmd, result)
        return {
            "status": "success" if result.get("code") == 0 else "failed",
            "cmd": cmd,
            "stdout": result.get("stdout"),
            "stderr": result.get("stderr"),
            "summary": summary
        }
